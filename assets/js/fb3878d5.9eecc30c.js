"use strict";(self.webpackChunkcogment_doc=self.webpackChunkcogment_doc||[]).push([[818],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>u});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),u=o,h=d["".concat(l,".").concat(u)]||d[u]||m[u]||r;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4661:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var a=n(3117),o=(n(7294),n(3905));const r={},i="Step 6: Add a web client for the human player",s={unversionedId:"guide/tutorial/web-client",id:"guide/tutorial/web-client",title:"Step 6: Add a web client for the human player",description:"This part of the tutorial follows step 5, make sure you've gone through it before starting this one. Alternatively the completed step 5 can be retrieved from the tutorial's repository.",source:"@site/docs/guide/tutorial/6-web-client.md",sourceDirName:"guide/tutorial",slug:"/guide/tutorial/web-client",permalink:"/docs/guide/tutorial/web-client",draft:!1,tags:[],version:"current",lastUpdatedAt:1668112711,formattedLastUpdatedAt:"11/10/2022",sidebarPosition:6,frontMatter:{},sidebar:"docSidebar",previous:{title:"Step 5: Add a human player in the loop",permalink:"/docs/guide/tutorial/human-player"},next:{title:"Step 7: Add a player trained with Reinforcement Learning using DQN",permalink:"/docs/guide/tutorial/dqn-player"}},l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"The web client",id:"the-web-client",level:2},{value:"Creating a React app",id:"creating-a-react-app",level:2},{value:"Adding Material UI",id:"adding-material-ui",level:2},{value:"Update the run script",id:"update-the-run-script",level:2},{value:"The parameters file",id:"the-parameters-file",level:2},{value:"Adding Cogment to our web client",id:"adding-cogment-to-our-web-client",level:2},{value:"index.js / index.css",id:"indexjs--indexcss",level:2},{value:"App.js",id:"appjs",level:2},{value:"hooks/useActions.js",id:"hooksuseactionsjs",level:2},{value:"Making it look good",id:"making-it-look-good",level:2}],p={toc:c};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"step-6-add-a-web-client-for-the-human-player"},"Step 6: Add a web client for the human player"),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This part of the tutorial follows ",(0,o.kt)("a",{parentName:"p",href:"/docs/guide/tutorial/human-player"},"step 5"),", make sure you've gone through it before starting this one. Alternatively the completed step 5 can be retrieved from the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cogment/cogment-tutorial-rps"},"tutorial's repository"),"."))),(0,o.kt)("p",null,"In this step of the tutorial, we will go over a web client implementation, to enable Humans to play RPS, while being able to take advantage of various web technologies."),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"To develop a web client, we will need a working installation of Node.js, version 14 or later. You can download and install this from: ",(0,o.kt)("a",{parentName:"p",href:"https://nodejs.org/en/download/"},"https://nodejs.org/en/download/")),(0,o.kt)("h2",{id:"the-web-client"},"The web client"),(0,o.kt)("p",null,"In the previous steps, we triggered the trials by running ",(0,o.kt)("inlineCode",{parentName:"p"},"./run.sh client_start"),". This launched a trial using code in ",(0,o.kt)("inlineCode",{parentName:"p"},"client/main.py"),". In this step we will trigger a trial using a React web app."),(0,o.kt)("p",null,"Before we start with the Cogment side of things, we'll need to get a few prerequisite files setup."),(0,o.kt)("h2",{id:"creating-a-react-app"},"Creating a React app"),(0,o.kt)("p",null,"First, we will initialize a React app. This can be done very simply by running from the root ",(0,o.kt)("inlineCode",{parentName:"p"},"rps")," folder:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"npx create-react-app web_client\n")),(0,o.kt)("p",null,"Once this is done, we will be able to open a React app in our browser by running the following commands:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"cd web_client\nnpm start\n")),(0,o.kt)("h2",{id:"adding-material-ui"},"Adding Material UI"),(0,o.kt)("p",null,"We will be using Material UI for this web client. This will provide us with a nice and clean way to add styles to our application, as well as some components which we will use to reduce code size."),(0,o.kt)("p",null,"Install Material UI by running the following commands from inside of the web_client folder:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"npm install @mui/material @emotion/react @emotion/styled\nnpm install @mui/icons-material\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Due to the nature of create-react-app when installed using the ",(0,o.kt)("inlineCode",{parentName:"p"},"npx")," command, the resulting installation will always utilize the latest version of React. This may cause dependecy issues when installing Material UI. As such, whenever such issues are encountered, please refer to the ",(0,o.kt)("a",{parentName:"p",href:"https://mui.com/material-ui/getting-started/installation/"},"Material UI documentation")," to confirm the correct required version of React."))),(0,o.kt)("h2",{id:"update-the-run-script"},"Update the run script"),(0,o.kt)("p",null,"In this tutorial we will add a new service that builds and serves the web clients. We will also need to configure the orchestrator to expose its services to the web client using grpcweb."),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Cogment internally relies on ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/improbable-eng/grpc-web/tree/master/go/grpcwebproxy"},(0,o.kt)("inlineCode",{parentName:"a"},"grpcwebproxy"))," to allow its grpc endpoints to be utilized by web applications. Web applications cannot natively use the grpc protocol that all Cogment modules use to communicate with one another. Using this proxy to translate the web socket connections it accepts into grpc requests solves this issue."))),(0,o.kt)("p",null,"We will need to update the ",(0,o.kt)("inlineCode",{parentName:"p"},"run.sh")," script and the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file to do that."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"run.sh")," script that we use for this tutorial is a helpful way to build services and run them, you can take inspiration from it in your own projects."))),(0,o.kt)("p",null,"To prepare for the additional service, let's add the following environment variables to the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"ORCHESTRATOR_HTTP_PORT=9003 # This is the port that orchestrator will listen on for grpcweb connections.\nWEB_CLIENT_PORT=8000 # This is the port that the web client will listen on.\n")),(0,o.kt)("p",null,"In the ",(0,o.kt)("inlineCode",{parentName:"p"},"./run.sh")," script we will add two new commands to build and start the web client:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'function web_client_build() {\n  _load_dot_env # Load the environment variables from the dotenv file\n  cp "${ROOT_DIR}/data.proto" "${ROOT_DIR}/cogment.yaml" "${ROOT_DIR}/web_client" # Copy the spec and protobuf files\n  cd "${ROOT_DIR}/web_client"\n  npm install # Install dependencies\n  npx cogment-js-sdk-generate cogment.yaml # Run the code generation phase\n}\n\nfunction web_client_start() {\n  _load_dot_env\n  export PORT="${WEB_CLIENT_PORT}" # Define the PORT the web client will use\n  export REACT_APP_ORCHESTRATOR_HTTP_ENDPOINT="http://${ORCHESTRATOR_HOST}:${ORCHESTRATOR_HTTP_PORT}" # Define the endpoint it will connect to\n  cd "${ROOT_DIR}/web_client"\n  npm start\n}\n')),(0,o.kt)("p",null,"We will also need to pass additional parameters to cogment when starting the orchestrator to enable the grpcweb server and to specifiy the trial parameters. The latter is needed because contrary to clients using the python sdk, web clients can't specify the trial parameters directly."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'function orchestrator_start() {\n  _load_dot_env\n  cogment services orchestrator \\\n    --actor_port="${ORCHESTRATOR_PORT}" \\\n    --lifecycle_port="${ORCHESTRATOR_PORT}" \\\n    --actor_web_port="${ORCHESTRATOR_HTTP_PORT}" \\\n    --params="./params.yaml"\n}\n')),(0,o.kt)("p",null,"Finally in this file, we will add the web client build to the ",(0,o.kt)("inlineCode",{parentName:"p"},"build")," command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"function build() {\n  _run_sequence client_build environment_build random_agent_build web_client_build\n}\n")),(0,o.kt)("h2",{id:"the-parameters-file"},"The parameters file"),(0,o.kt)("p",null,"The parameters file is a ",(0,o.kt)("inlineCode",{parentName:"p"},".yaml")," file that specifies the default trial parameters to Cogment. In this tutorial, we will use the following parameters:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"trial_params:\n    environment:\n        endpoint: grpc://localhost:9001\n\n    actors:\n        - name: player_1\n          actor_class: player\n          endpoint: cogment://client\n        - name: player_2\n          actor_class: player\n          implementation: heuristic_agent\n          endpoint: grpc://localhost:9002\n")),(0,o.kt)("p",null,"Create a ",(0,o.kt)("inlineCode",{parentName:"p"},"params.yaml")," file in the root folder with the previous content."),(0,o.kt)("h2",{id:"adding-cogment-to-our-web-client"},"Adding Cogment to our web client"),(0,o.kt)("p",null,"The easiest way to add Cogment to any web client is to start with a React app, then follow the three steps below:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Install the Javascript SDK and typescript using:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-console"},"npm install @cogment/cogment-js-sdk\nnpm install --save-dev typescript\n")),(0,o.kt)("p",{parentName:"li"},"while inside of the ",(0,o.kt)("inlineCode",{parentName:"p"},"web_client")," folder")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Copy the hooks folder from the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cogment/cogment-tutorial-rps"},"tutorial's repository"),", found at ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cogment/cogment-tutorial-rps/tree/main/6-web-client/web_client/src"},"6-web-client/web_client/src/"),", into your src folder.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Navigate nack to the ",(0,o.kt)("inlineCode",{parentName:"p"},"rps")," folder then run the following command to generate Javascript files from your trial specs:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-console"},"./run.sh web_client_build\n")))),(0,o.kt)("p",null,"Now that all that's done, we can finally start coding our web client!"),(0,o.kt)("h1",{id:"code"},"CODE"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"NOTE: For each of the following files, we will provide the styles in a code block. Feel free to skip these, or make your own; they are not important to the function of this application.")),(0,o.kt)("h2",{id:"indexjs--indexcss"},"index.js / index.css"),(0,o.kt)("p",null,"When we created our React app, these two files were generated automatically. Replace their content with the following:"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"NOTE: These can also be downloaded from the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cogment/cogment-tutorial-rps"},"tutorial's repository"),".")),(0,o.kt)("p",null,"index.css:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},"body {\n    margin: 0;\n    background-color: #c5cce8;\n}\n")),(0,o.kt)("p",null,"index.js"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'import React from "react";\nimport ReactDOM from "react-dom/client";\nimport "./index.css";\nimport { App } from "./App";\nimport {\n    createTheme,\n    responsiveFontSizes,\n    ThemeProvider,\n} from "@mui/material/styles";\n\nlet theme = createTheme({\n    palette: {\n        primary: {\n            light: "#c5cce8",\n            main: "#6B80C4",\n        },\n        secondary: {\n            main: "#ffb400",\n        },\n    },\n});\n\ntheme = responsiveFontSizes(theme);\n\nconst root = ReactDOM.createRoot(document.getElementById(\'root\'));\nroot.render(\n    <React.StrictMode>\n        <ThemeProvider theme={theme}>\n            <App />\n        </ThemeProvider>\n    </React.StrictMode>\n);\n')),(0,o.kt)("p",null,"This is simply to provide styles to our Material UI components. We haven't started with the actual Cogment part yet, which is exactly what we'll be doing next."),(0,o.kt)("h2",{id:"appjs"},"App.js"),(0,o.kt)("p",null,"We'll start with a few imports. Some of these files don't exist yet, so we'll be creating them:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'//First is some React imports\nimport React, { useEffect } from "react";\n\n//Then some imports for icons and Material UI functionality we\'ll be using\nimport {\n    Box,\n    Button,\n    Typography,\n} from "@mui/material";\nimport { useTheme } from "@mui/material/styles";\n\n//And here\'s the important part: we\'re importing the two things that will allow us to use Cogment.\n\n//First, the \'useActions\' hook which will give us our observations as a human agent, as well as allow us to send actions.\nimport { useActions } from "./hooks/useActions";\n\n//Second, our \'cogSettings\'. This is a file that was generated when we ran\n//`npx cogment-js-sdk-generate cogment.yaml`\n//This file tells our web client relevant information about our trials, environments, and actor classes.\nimport { cogSettings } from "./CogSettings";\n\n//These are messages which were defined in data.proto. These imports will need to change whenever their corresponding messages in data.proto are changed and `npx cogment-js-sdk-generate cogment.yaml` is run.\nimport { rps as PB } from "./data_pb";\n')),(0,o.kt)("p",null,'Then we add a function that will convert the play, encoded as the same "move" enum that we defined in our data.proto, to a string we can use in our application:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'function getMoveText(move) {\n    switch (move) {\n        case 0:\n            return "rock";\n        case 1:\n            return "paper";\n        case 2:\n            return "scissors";\n        default:\n            throw new Error("Not a rock, paper, or scissors");\n    }\n}\n')),(0,o.kt)("p",null,"Finally, the React component."),(0,o.kt)("p",null,"At the start of this component is the most important part of our application: the useAction hook."),(0,o.kt)("p",null,"This hook returns an array with 3 elements:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"event: this contains all the information about any observation, reward, or message we've received this tick. We will use this to see what plays we and the computer made.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"startTrial: this is a function which takes no arguments, and is a very simple way to start a new trial with our player actor.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"sendAction: this is a function which takes an argument of type 'Action'. This class can be imported from data_pb.js, but we'll see that later in this tutorial."))),(0,o.kt)("p",null,"This hook takes in 3 arguments:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"cogSettings: this is what's imported from CogSettings.js. It provides all the relevant information about data.proto to this hook so that it can function.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"actorName: the name of the human actor which this web client will be representing. It should be aligned with what's defined in ",(0,o.kt)("inlineCode",{parentName:"p"},"params.yaml"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"actorClass: the class of the human actor which this web client will be representing. It should be aligned with what's defined in ",(0,o.kt)("inlineCode",{parentName:"p"},"params.yaml"),"."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'export const App = () => {\n    const [event, startTrial, sendAction] = useActions(\n        cogSettings,\n        "player_1",\n        "player"\n    );\n\n    //Function to construct the Action which the player will send when they click either rock, paper, or scissors\n    const choose = (move) => {\n        const action = new PB.PlayerAction({\n            move,\n        });\n        sendAction(action);\n    };\n\n    //This will start a trial as soon as we\'re connected to the orchestrator\n    useEffect(() => {\n        if (startTrial) startTrial();\n    }, [startTrial]);\n\n    //Get any observation from the current event, events have observations, messages, and rewards, and all three can be unpacked from the event object\n    //We will also unpack a helpful variable called \'last\', this will allow us to know when the trial has ended\n    const { observation, last } = event;\n\n    const [gameState, setGameState] = useState({\n        gameStage: "start",\n        roundIndex: 0,\n        lastMoveComputer: 0,\n        lastMoveHuman: 0,\n    });\n    const [firstObservation, setFirstObservation] = useState(true);\n\n    useEffect(() => {\n        //Parse game state out of the observation\n        //Some events don\'t contain an observation, so we need to store the observation contents in a state\n        if (!observation) return;\n\n        //The first observation is not useful, as it just contains the default game state, before players have made moves\n        if (firstObservation) {\n            setFirstObservation(false);\n            return;\n        }\n\n        //Get all relevant information from the observation\n        const roundIndex = gameState.roundIndex + 1;\n        const gameStage = "playing";\n        const lastMoveComputer = observation.them.lastMove;\n        const lastMoveHuman = observation.me.lastMove;\n        const lastWonComputer = observation.them.wonLast;\n        const lastWonHuman = observation.me.wonLast;\n\n        setGameState({\n            gameStage,\n            roundIndex,\n            lastMoveComputer,\n            lastMoveHuman,\n            lastWonComputer,\n            lastWonHuman,\n        });\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [observation]);\n\n    //The layout of the page\n    return (\n        <Box>\n            {/*\n        Tell the player everything we know about the trial state, such as, plays, who won, etc...\n      */}\n            <Typography>Game stage: {gameState.gameStage}</Typography>\n            <Typography>\n                Human\'s move:{" "}\n                {gameState.gameStage !== "start" &&\n                    getMoveText(gameState.lastMoveHuman)}\n            </Typography>\n            <Typography>\n                Computer\'s move:{" "}\n                {gameState.gameStage !== "start" &&\n                    getMoveText(gameState.lastMoveComputer)}\n            </Typography>\n            <Typography>\n                Did Human win last round?{" "}\n                {observation && gameState.lastWonHuman ? "Yes" : "No"}\n            </Typography>\n            <Typography>\n                Did Computer win last round?{" "}\n                {observation && gameState.lastWonComputer ? "Yes" : "No"}\n            </Typography>\n            <Button onClick={() => choose(0)}>Rock</Button>\n            <Button onClick={() => choose(1)}>Paper</Button>\n            <Button onClick={() => choose(2)}>Scissors</Button>\n        </Box>\n    );\n};\n')),(0,o.kt)("h2",{id:"hooksuseactionsjs"},"hooks/useActions.js"),(0,o.kt)("p",null,"This hook does multiple things. It starts a trial, joins a trial, sends actions, and receives information from the orchestrator. The following is its annotated code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'import { Context } from "@cogment/cogment-js-sdk";\nimport { useEffect, useState } from "react";\n\nexport const useActions = (cogSettings, actorName, actorClass) => {\n    const [event, setEvent] = useState({\n        observation: null,\n        actions: null,\n        messages: null,\n        rewards: null,\n        type: null,\n        last: false,\n    });\n\n    const [startTrial, setStartTrial] = useState(null);\n    const [sendAction, setSendAction] = useState(null);\n\n    //Set up the connection and register the actor only once, regardless of re-rendering\n    useEffect(() => {\n        const context = new Context(cogSettings, actorName);\n\n        context.registerActor(\n            async (actorSession) => {\n                actorSession.start();\n\n                //Double arrow function here beause react will turn a single one into a lazy loaded function\n                setSendAction(() => (action) => {\n                    actorSession.doAction(action);\n                });\n\n                for await (const event of actorSession.eventLoop()) {\n                    const eventUseActions = event;\n\n                    eventUseActions.last = event.type === 3;\n\n                    setEvent(eventUseActions);\n                }\n            },\n            actorName,\n            actorClass\n        );\n\n        const endpoint = process.env.REACT_APP_ORCHESTRATOR_HTTP_ENDPOINT;\n        const controller = context.getController(endpoint);\n\n        //Need to output a function so that the user can start the trial when all actors are connected\n        //Again, double arrow function cause react will turn a single one into a lazy loaded function\n        setStartTrial(() => async () => {\n            const trialId = await controller.startTrial();\n            await context.joinTrial(trialId, endpoint, actorName);\n        });\n    }, [cogSettings, actorName, actorClass]);\n\n    return [event, startTrial, sendAction];\n};\n')),(0,o.kt)("p",null,"We also need to create ",(0,o.kt)("inlineCode",{parentName:"p"},"web_client/.eslintignore")," and add the following to it to ignore checks on the generate files:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"src/*_pb*\nsrc/cog_settings*\n")),(0,o.kt)("p",null,"You can now see our app fully functional running the following commands in the ",(0,o.kt)("inlineCode",{parentName:"p"},"rps")," folder:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"./run.sh build\n./run.sh services_start\n")),(0,o.kt)("p",null,"In another terminal, start the web client:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"}," ./run.sh web_client_start\n")),(0,o.kt)("p",null,"And opening up <localhost:8000> in our browser."),(0,o.kt)("p",null,"And with that we're done!"),(0,o.kt)("h2",{id:"making-it-look-good"},"Making it look good"),(0,o.kt)("p",null,"If we want a fancier interface, there is a completed UI in the tutorials repository that we can copy into our project. Then, along with some style code that can be found in the repository version of App.js, just replace the return statement from App.js with the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'<Box>\n    <Header observation={observation} gameState={gameState} />\n    <Container className={classes.container}>\n        <Player\n            score={humanScore}\n            color={theme.palette.primary.main}\n            IconClass={PersonIcon}\n            choose={choose}\n            isHuman\n        />\n\n        <Player\n            score={computerScore}\n            color={theme.palette.secondary.main}\n            IconClass={ComputerIcon}\n            selected={\n                gameState !== "start" &&\n                getMoveText(observation.them.lastRoundMove)\n            }\n        />\n    </Container>\n</Box>\n')))}m.isMDXComponent=!0}}]);