---
title: Directory
sidebar_position: 3
---

# Directory

The Directory is an implementation of the [directory gRPC service](../grpc.md#directory-api). It is the service to find other services. Typically, every other Cogment service only needs to know the address of the Directory to access anything in Cogment.

The Directory works in tandem with the Cogment [endpoints](../parameters.md#cogment-endpoints), in particular the ones with a [discover](../parameters.md#discover-host) host (refered as **dicovery endpoints**).

A [Directory Client](./directory_client.md#directory-client) is also part of the Cogment CLI to access the Directory from the command line.

## Command line

The Directory is a Cogment CLI service:

```bash
$ cogment services directory --port=9005
```

## Options

### `port`

The TCP port where to serve the [directory gRPC service](../grpc.md#directory-api). This is where the users of the Directory connect to.

Can be specified as:

-   a command line option, e.g. `--port`,
-   an environment variable, e.g. `COGMENT_DIRECTORY_PORT`,
-   its default value is 9005.

### `grpc_reflection`

Whether or not to enable [gRPC reflection](https://github.com/grpc/grpc/blob/master/doc/server-reflection.md) on the served directory endpoint.

Can be specified as:

-   a command line option, e.g. `--grpc_reflection`,
-   an environment variable, e.g. `COGMENT_DIRECTORY_GRPC_REFLECTION=1`,
-   by default, it is disabled.

## Operation

At its most basic, the Directory contains services searchable by type and property, and returns endpoints where to reach the matched services.

Every registered service has a unique ID (it is unique among currently registered services). When registering a service, the ID of the new service is provided with a "secret" key (a string). This "secret" is used to deregister the service.

Every service is also associated with an authentication token. This token is provided by users when registering a new service, and it must be provided to inquire or deregister that service. For example, any inquiry can only find services that have the same authentication token as the one provided to the inquiry. Similarly for deregistering: a service cannot be deregistered without the appropriate authentication token. In closed environments, the authentication token can be left empty to facilitate directory management.

### Data

The Directory maintains the following data for each service:

- service ID: This is a numerical (unsigned integer of 64 bits) value generated by the Directory and assigned to the service on registration. It is unique to that service as long as it is in the Directory. Although very unlikely, it is possible for this ID to be re-used after the service is deregistered.
- endpoint: It consists of four distinct information:
    - protocol: The protocol (URL scheme) for the endpoint (`grpc` or `cogment`).
    - host: The TCP host for the endpoint (e.g. somewhere.com). For the `grpc` protocol it can be a network hostname or an IP address. For the `cogment` protocol it must be a registered name (see [cogment endpoints](../parameters.md#cogment-endpoints)).
    - port: The TCP port where the registered service is providing its services.
    - ssl requirement: Whether the service requires an encrypted SSL connection.
- type: The type of service.
    - client actor connection: Provides [client actor](../grpc.md#service-clientactorsp) grpc API service
    - trial lifecycle management: Provides [lifecycle](../grpc.md#service-triallifecyclesp) grpc API service 
    - actor: Provides [actor](../grpc.md#service-actor-api) grpc API service 
    - environment: Provides [environment](../grpc.md#service-environmentsp) grpc API service 
    - pre-hook: Provides [pre-hook](../grpc.md#service-trialhookssp) grpc API service 
    - datalog: Provides [datalog](../grpc.md#service-logexportersp) grpc API service 
    - datastore: Provides [datastore](../grpc.md#service-trialdatastoresp) grpc API service 
    - model registry: Provides [model registry](../grpc.md#service-modelregistrysp) grpc API service 
    - other: This type of service does not provide a grpc API service or it is not a globally defined type of service.
- properties: This is a free form mapping of name and value strings. But Cogment may require properties of specific names for its operation, in particular for endpoint [discovery](../parameters.md#cogment-endpoints)). These special property names are prefixed with a double underscore (\_\_), e.g. `__implementation`. Also, for proper use in Cogment, property names and values should be restricted to a limited character set (see [](../parameters.md#discovery-query)).
- secret: This is a secret string that is generated by the Directory on registering a new service. It must be provided to deregister a service. There is no way to recover this value, so it must be recorded after registration.
- authentication token: A string to authenticate users of the registered service. It is provided by the user for registration of a new service, and the same token must be provided to access (deregister or inquire) that service.
